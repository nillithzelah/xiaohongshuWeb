# 审核系统改进计划

## 📋 修改项目清单

### 1. 内容关键词审核机制
**目标**：在笔记和评论审核的第一步，解析网页内容，识别特定关键词

**关键词列表**：
- 减肥被骗
- 护肤被骗
- 祛斑被骗
- 丰胸被骗
- 医美被骗
- 白发转黑被骗
- 手镯定制被骗

**审核逻辑**：
- 解析网页内容，检查是否包含上述关键词之一
- 如果不包含任何关键词，驳回审核
- 驳回原因：`帖子内容和工作要求匹配度过低`

**实施位置**：
- 修改 `xiaohongshuService.js` 的 `parseNoteContent` 方法
- 在 `asyncAiReviewService.js` 的审核逻辑中添加关键词检查

---

### 2. 新增设备账号人工审核机制
**目标**：新增设备账号需要双重审核（AI审核 + 人工审核）

**网页端修改**：
- 在管理后台添加设备审核页面
- 显示待审核的新增设备账号
- 提供审核通过/拒绝功能

**小程序端修改**：
- 新增设备账号时，必须上传一张图片
- 提示文字：`请上传小红薯个人页面截图`
- 图片作为审核凭证

**审核流程**：
1. 用户提交设备账号 + 个人页面截图
2. 系统进行AI审核
3. AI审核通过后，进入人工审核队列
4. 管理员在网页端进行最终审核

---

### 3. 评论二次审核机制
**目标**：评论审核改为两次尝试，提高成功率

**审核时间设置**：
- 第一次审核：等待90秒后执行
- 第二次审核：如果第一次失败，等待150秒后再次执行

**审核逻辑**：
- 第一次审核成功 → 直接通过
- 第一次审核失败 → 执行第二次审核
- 第二次审核成功 → 通过
- 第二次审核失败 → 驳回

**实施位置**：
- 修改 `asyncAiReviewService.js` 的评论审核逻辑
- 添加重试机制和时间控制

---

### 4. 笔记异步审核机制
**目标**：笔记审核改为异步处理，添加二次审核

**审核时间设置**：
- 第一次审核：等待120秒后执行
- 第二次审核：等待180秒后再次执行

**修改内容**：
- 将当前同步的笔记审核改为异步队列处理
- 参考评论的异步审核实现
- 添加两次审核尝试

**实施位置**：
- 修改笔记审核的调用方式
- 集成到 `AsyncAiReviewService` 队列中
- 添加重试逻辑

---

### 5. 时间记录北京时间标准化
**目标**：确保所有时间记录使用北京时间（UTC+8）

**检查范围**：
- 审核历史时间戳
- 数据库记录的创建时间
- 日志时间
- 定时任务时间

**实施内容**：
- 检查所有 `new Date()` 调用
- 确保时间显示为北京时间
- 数据库时间字段标准化

---

## 🔄 实施优先级

1. **高优先级**：内容关键词审核（影响审核准确性）
2. **高优先级**：时间记录标准化（数据一致性）
3. **中优先级**：设备账号人工审核（新功能）
4. **中优先级**：评论二次审核（提高成功率）
5. **低优先级**：笔记异步审核（性能优化）

---

## 📝 技术实现要点

- **关键词检测**：使用正则表达式或字符串包含检查
- **异步队列**：复用现有的 `AsyncAiReviewService` 架构
- **时间处理**：统一使用北京时区
- **人工审核**：新增管理后台页面和API
- **重试机制**：添加失败重试逻辑和时间间隔控制

---

## ✅ 验收标准

1. 包含指定关键词的帖子能够通过审核
2. 不包含关键词的帖子被驳回，原因明确
3. 新增设备账号需要上传截图并经过人工审核
4. 评论审核在失败时会自动重试
5. 笔记审核改为异步处理，支持重试
6. 所有时间显示为北京时间