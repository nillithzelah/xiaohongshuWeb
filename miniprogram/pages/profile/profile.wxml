<!--pages/profile/profile.wxml-->
<view class="container">
  <!-- å¤´éƒ¨åŒºåŸŸ -->
  <view class="profile-header">
    <view class="avatar-section">
      <image class="avatar" src="{{userInfo.avatar || '/images/default-avatar.png'}}" mode="cover"></image>
      <view class="user-info">
        <text class="nickname">{{userInfo.nickname || 'æœªè®¾ç½®æ˜µç§°'}}</text>
        <text class="username">{{userInfo.username}}</text>
        <!-- æµ‹è¯•ç”¨æˆ·æ ‡è¯† -->
        <view class="test-user-badge" wx:if="{{testUser}}">
          <text class="test-badge-text">ğŸ§ª æµ‹è¯•æ¨¡å¼</text>
        </view>
      </view>
    </view>
  </view>

  <!-- èµ„äº§å¡ç‰‡ -->
  <view class="assets-card">
    <view class="asset-item">
      <view class="asset-icon">ğŸ’°</view>
      <view class="asset-info">
        <text class="asset-value">{{balance}}</text>
        <text class="asset-label">ç§¯åˆ†ä½™é¢</text>
      </view>
    </view>
    <view class="asset-divider"></view>
    <view class="asset-item">
      <view class="asset-icon">ğŸ“ˆ</view>
      <view class="asset-info">
        <text class="asset-value">Â¥{{totalEarnings}}</text>
        <text class="asset-label">ç´¯è®¡æ”¶ç›Š</text>
      </view>
    </view>
  </view>

  <!-- èœå•åˆ—è¡¨ -->
  <view class="menu-section">
    <navigator url="/pages/device-list/device-list" class="menu-item">
      <view class="menu-icon">ğŸ“±</view>
      <text class="menu-text">æˆ‘çš„è®¾å¤‡ç®¡ç†</text>
      <view class="menu-arrow">â€º</view>
    </navigator>

    <!-- æµ‹è¯•æ¨¡å¼ï¼šç”¨æˆ·åˆ‡æ¢ -->
    <view class="menu-item" bindtap="showUserSelector">
      <view class="menu-icon">ğŸ‘¤</view>
      <text class="menu-text">æµ‹è¯•æ¨¡å¼ - åˆ‡æ¢ç”¨æˆ·</text>
      <view class="menu-badge">æµ‹è¯•</view>
      <view class="menu-arrow">â€º</view>
    </view>

    <view class="menu-item" bindtap="logout">
      <view class="menu-icon">ğŸšª</view>
      <text class="menu-text">é€€å‡ºç™»å½•</text>
      <view class="menu-arrow">â€º</view>
    </view>
  </view>

  <!-- åº•éƒ¨æç¤º -->
  <view class="footer-tips">
    <text>ğŸ’¡ å¦‚æœ‰é—®é¢˜è¯·è”ç³»å®¢æœ</text>
  </view>

  <!-- ç”¨æˆ·é€‰æ‹©å™¨å¼¹çª— -->
  <view class="user-selector-modal" wx:if="{{showUserSelector}}" bindtap="hideUserSelector">
    <view class="modal-content" bindtap="">
      <view class="modal-header">
        <text class="modal-title">é€‰æ‹©æµ‹è¯•ç”¨æˆ·</text>
        <view class="modal-close" bindtap="hideUserSelector">Ã—</view>
      </view>

      <view class="modal-body">
        <view class="user-list">
          <view
            wx:for="{{users}}"
            wx:key="_id"
            class="user-item"
            bindtap="selectUser"
            data-user="{{item}}"
          >
            <view class="user-avatar">{{item.username.charAt(0).toUpperCase()}}</view>
            <view class="user-details">
              <text class="user-name">{{item.username}}</text>
              <text class="user-nickname" wx:if="{{item.nickname}}">({{item.nickname}})</text>
              <text class="user-role">{{item.role}}</text>
            </view>
            <view class="user-points">ç§¯åˆ†: {{item.points || 0}}</view>
          </view>
        </view>
      </view>

      <view class="modal-footer">
        <button class="cancel-btn" bindtap="hideUserSelector">å–æ¶ˆ</button>
      </view>
    </view>
  </view>
</view>