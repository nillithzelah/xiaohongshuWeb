<!--pages/distribution/distribution.wxml-->
<view class="container">
  <!-- æ ‡é¢˜ -->
  <view class="page-header">
    <text class="page-title">æˆ‘çš„åˆ†é”€</text>
  </view>

  <!-- åˆ†é”€ç§¯åˆ†å¡ç‰‡ -->
  <view class="points-card">
    <view class="points-icon">ğŸ’°</view>
    <view class="points-info">
      <text class="points-value">{{distributionPoints}}</text>
      <text class="points-label">åˆ†é”€ç§¯åˆ†</text>
    </view>
  </view>

  <!-- ä¸Šä¸‹çº§å…³ç³» -->
  <view class="relationship-section">
    <!-- ä¸Šçº§ -->
    <view class="relationship-card" wx:if="{{referralTree.parent}}">
      <view class="card-header">
        <text class="card-title">æˆ‘çš„ä¸Šçº§</text>
      </view>
      <view class="user-item">
        <view class="user-avatar">ğŸ‘¤</view>
        <view class="user-info">
          <text class="user-name">{{referralTree.parent.nickname || referralTree.parent.username}}</text>
          <text class="user-role">ä¸Šçº§ç”¨æˆ·</text>
        </view>
      </view>
    </view>

    <!-- ä¸‹çº§ -->
    <view class="relationship-card" wx:if="{{referralTree.children && referralTree.children.length > 0}}">
      <view class="card-header">
        <text class="card-title">æˆ‘çš„ä¸‹çº§ ({{referralTree.children.length}}äºº)</text>
      </view>
      <view class="user-list">
        <view class="user-item" wx:for="{{referralTree.children}}" wx:key="username">
          <view class="user-avatar">ğŸ‘¤</view>
          <view class="user-info">
            <text class="user-name">{{item.nickname || item.username}}</text>
            <text class="user-role">åŠ å…¥æ—¶é—´: {{item.joinedAt.substring(0,10)}}</text>
          </view>
        </view>
      </view>
    </view>

    <!-- ä¸‹çº§çš„ä¸‹çº§ -->
    <view class="relationship-card" wx:if="{{referralTree.grandchildren && referralTree.grandchildren.length > 0}}">
      <view class="card-header">
        <text class="card-title">ä¸‹çº§çš„å¥½å‹ ({{referralTree.grandchildren.length}}äºº)</text>
      </view>
      <view class="user-list">
        <view class="user-item" wx:for="{{referralTree.grandchildren}}" wx:key="username">
          <view class="user-avatar">ğŸ‘¤</view>
          <view class="user-info">
            <text class="user-name">{{item.nickname || item.username}}</text>
            <text class="user-role">åŠ å…¥æ—¶é—´: {{item.joinedAt.substring(0,10)}}</text>
          </view>
        </view>
      </view>
    </view>

    <!-- ç©ºçŠ¶æ€ -->
    <view class="empty-state" wx:if="{{!referralTree || (!referralTree.parent && (!referralTree.children || referralTree.children.length === 0) && (!referralTree.grandchildren || referralTree.grandchildren.length === 0))}}">
      <view class="empty-icon">ğŸŒŸ</view>
      <text class="empty-text">æš‚æ— åˆ†é”€å…³ç³»</text>
      <text class="empty-hint">é‚€è¯·å¥½å‹åŠ å…¥å³å¯å»ºç«‹åˆ†é”€å…³ç³»</text>
    </view>
  </view>

  <!-- åŠ è½½çŠ¶æ€ -->
  <view class="loading" wx:if="{{loading}}">
    <text>åŠ è½½ä¸­...</text>
  </view>
</view>