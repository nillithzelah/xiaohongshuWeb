<!--pages/account-detail/account-detail.wxml-->
<view class="container">
  <!-- 页面标题 -->
  <view class="page-header">
    <view class="header-content">
      <text class="page-title">账号信息</text>
      <text class="page-desc">查看您的详细账号信息</text>
    </view>
    <view class="header-actions">
      <button class="edit-btn" bindtap="showEditModal">编辑</button>
    </view>
  </view>

  <!-- 账号信息卡片 -->
  <view class="info-section">
    <!-- 基本信息 -->
    <view class="info-card">
      <view class="card-header">
        <text class="card-title">基本信息</text>
      </view>
      <view class="info-list">
        <view class="info-item">
          <text class="info-label">用户名</text>
          <text class="info-value">{{userInfo.username}}</text>
        </view>
        <view class="info-item">
          <text class="info-label">昵称</text>
          <text class="info-value">{{userInfo.nickname || '未设置'}}</text>
        </view>
        <view class="info-item">
          <text class="info-label">手机号</text>
          <text class="info-value">{{userInfo.phone || '未绑定'}}</text>
        </view>
      </view>
    </view>

    <!-- 积分号信息 -->
    <view class="info-card">
      <view class="card-header">
        <text class="card-title">积分号信息</text>
      </view>
      <view class="info-list">
        <view class="info-item">
          <text class="info-label">积分号Z</text>
          <text class="info-value">{{maskedIntegralZ}}</text>
        </view>
        <view class="info-item">
          <text class="info-label">积分号W</text>
          <text class="info-value">{{maskedIntegralW}}</text>
        </view>
      </view>
    </view>

    <!-- 导师信息 -->
    <view class="info-card">
      <view class="card-header">
        <text class="card-title">导师信息</text>
      </view>
      <view class="info-list">
        <view class="info-item">
          <text class="info-label">带教老师</text>
          <text class="info-value">{{mentorName}}</text>
        </view>
        <view class="info-item">
          <text class="info-label">上级用户</text>
          <text class="info-value">{{parentName}}</text>
        </view>
      </view>
    </view>

    <!-- 邀请码信息 -->
    <view class="info-card">
      <view class="card-header">
        <text class="card-title">邀请码信息</text>
      </view>
      <view class="info-list">
        <view class="info-item">
          <text class="info-label">我的邀请码</text>
          <view class="invitation-section">
            <text class="info-value">{{invitationCode}}</text>
            <button
              class="copy-btn"
              bindtap="copyInvitationCode"
              wx:if="{{invitationCode && invitationCode !== '暂无'}}"
              size="mini"
            >
              复制
            </button>
          </view>
        </view>
      </view>
    </view>
  </view>

  <!-- 加载状态 -->
  <view class="loading" wx:if="{{loading}}">
    <text>加载中...</text>
  </view>

  <!-- 编辑信息弹窗 -->
  <view class="edit-modal" wx:if="{{showEditModal}}">
    <view class="modal-mask" bindtap="hideEditModal"></view>
    <view class="modal-content">
      <view class="modal-header">
        <text class="modal-title">编辑个人信息</text>
        <view class="close-btn" bindtap="hideEditModal">✕</view>
      </view>
      <view class="modal-body">
        <view class="form-item">
          <text class="form-label">用户名</text>
          <input class="form-input" value="{{editForm.username}}" bindinput="onUsernameInput" placeholder="请输入用户名" />
        </view>
        <view class="form-item">
          <text class="form-label">昵称</text>
          <input class="form-input" value="{{editForm.nickname}}" bindinput="onNicknameInput" placeholder="请输入昵称" />
        </view>
        <view class="form-item">
          <text class="form-label">新密码</text>
          <input class="form-input" type="password" value="{{editForm.newPassword}}" bindinput="onNewPasswordInput" placeholder="请输入新密码（可选，不填则不修改）" />
        </view>
        <view class="form-item">
          <text class="form-label">确认密码</text>
          <input class="form-input" type="password" value="{{editForm.confirmPassword}}" bindinput="onConfirmPasswordInput" placeholder="请再次输入新密码" />
        </view>
        <view class="form-item">
          <text class="form-label">上级邀请码</text>
          <input class="form-input" value="{{editForm.parentInvitationCode}}" bindinput="onParentInvitationInput" placeholder="请输入上级邀请码（可选）" />
        </view>
      </view>
      <view class="modal-footer">
        <button class="cancel-btn" bindtap="hideEditModal">取消</button>
        <button class="confirm-btn" bindtap="updateProfile" loading="{{updating}}">保存</button>
      </view>
    </view>
  </view>
</view>