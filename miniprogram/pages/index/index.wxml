<!-- pages/index/index.wxml -->
<view class="container">

  <!-- ğŸ‘¤ ç®€åŒ–çš„ç”¨æˆ·ä¿¡æ¯å¤´å›¾ (é™æ€å±•ç¤ºï¼Œä¸éœ€æŒ‰é’®) -->
  <view class="header-card">
    <view class="user-info">
      <view class="avatar-container">
        <image class="avatar" src="{{userInfo.avatarUrl || 'https://mmbiz.qpic.cn/mmbiz/icTdbqWNOwNRna42FI242Lcia07jQodd2FJGIYQfG0LAJGFxM4FbnQP6yfMxBgJ0F3YRqJCJ1aPAK2dQagdusBZg/0'}}" mode="cover"></image>
      </view>
      <view class="user-text">
        <view class="greeting">ä½ å¥½ï¼Œ{{userInfo.nickName || 'å¥‹æ–—è€…'}}</view>
        <view class="subtitle">ä»Šå¤©ä¹Ÿæ˜¯åŠªåŠ›æé’±çš„ä¸€å¤©ï¼ğŸ’ª</view>
      </view>
    </view>
  </view>

  <!-- ï¸ ç”»å»Šè½®æ’­å›¾ -->
  <view class="banner-container">
    <swiper
      class="card-swiper"
      indicator-dots="{{true}}"
      indicator-color="rgba(255, 255, 255, .3)"
      indicator-active-color="#ffffff"
      autoplay="{{true}}"
      interval="4000"
      duration="500"
      circular="{{true}}"
      previous-margin="60rpx"
      next-margin="60rpx"
      bindchange="cardSwiper"
    >
      <block wx:for="{{bannerList}}" wx:key="id">
        <swiper-item class="card-swiper-item">
          <view class="swiper-box {{cardCur==index?'cur':''}}">
            <image src="{{item.url}}" class="swiper-image" mode="aspectFill"></image>
            <!-- å¯ä»¥åœ¨å›¾ä¸ŠåŠ æ–‡å­— -->
            <view class="swiper-text" wx:if="{{item.title}}">{{item.title}}</view>
          </view>
        </swiper-item>
      </block>
    </swiper>
  </view>

  <!-- ğŸ“‹ å®¡æ ¸è®°å½•åˆ—è¡¨ -->
  <view class="list-container">
    <view class="list-header">è¿‘æœŸå®¡æ ¸è®°å½•</view>

    <!-- ç©ºçŠ¶æ€ -->
    <view class="empty-state" wx:if="{{!loading && reviews.length === 0}}">
      <image class="empty-icon" src="https://img.icons8.com/ios/100/cccccc/empty-box.png" mode="widthFix"></image>
      <text>æš‚æ— è®°å½•ï¼Œå¿«å»ä¸Šä¼ ç¬¬ä¸€å•å§~</text>
      <button class="go-upload-btn" bindtap="goToUpload">å»ä¸Šä¼ </button>
    </view>

    <!-- åˆ—è¡¨å†…å®¹ -->
    <block wx:for="{{reviews}}" wx:key="_id">
      <view class="review-card">
        <image class="card-thumb" src="{{item.imageUrl}}" mode="aspectFill"></image>
        <view class="card-content">
          <view class="card-row">
            <text class="task-type">{{item.imageType === 'customer_resource' ? 'å®¢èµ„' : (item.imageType === 'note' ? 'ç¬”è®°' : 'è¯„è®º')}}</text>
            <view class="status-tag {{item.status}}">
              {{
                item.status === 'completed' || item.status === 'finance_done' ? 'å·²åˆ°è´¦' :
                (item.status === 'rejected' ? 'å·²é©³å›' : 'å®¡æ ¸ä¸­')
              }}
            </view>
          </view>
          <view class="card-row time-row">
            <text class="submit-time">{{item.formattedTime}}</text>
            <text class="amount" wx:if="{{item.status === 'completed' || item.status === 'finance_done'}}">+ Â¥{{item.snapshotPrice}}</text>
          </view>

          <!-- é©³å›åŸå›  -->
          <view class="reject-reason" wx:if="{{item.status === 'rejected'}}">
            é©³å›åŸå› ï¼š{{item.rejectionReason || 'ä¸ç¬¦åˆè¦æ±‚'}}
          </view>
        </view>
      </view>
    </block>

    <!-- åŠ è½½æ›´å¤š/åˆ°åº•æç¤º -->
    <view class="loading-more" wx:if="{{reviews.length > 0}}">
      {{hasMore ? 'åŠ è½½ä¸­...' : '--- åˆ°åº•å•¦ ---'}}
    </view>
  </view>
</view>