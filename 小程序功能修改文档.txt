# 小程序功能修改文档

## 概述
本文件描述小程序和网页端需要实现的功能修改。

## 功能修改清单

### 1. 个人信息修改 ⭐新增功能
位置: 个人资料页面
功能: 添加个人信息修改按钮
可修改内容: 用户名、密码、上级邀请码
邀请码逻辑: 所有用户都可以显示自己的邀请码，用于建立上下级关系
显示信息: 积分号Z/W（脱敏显示）、带教老师名称
其他功能: 登出按钮

### 2. 设备管理 (改名为账号管理) ⭐部分修改
位置: 设备管理页面
功能: 新增账号、修改账号昵称、删除账号
审核机制: 新增和修改需要AI审核，验证昵称和账号匹配

### 3. 分销系统展示 ⭐新增功能
位置: 新增页面
功能: 显示上下级关系和分销积分

### 4. 投诉功能 ⭐新增功能
位置: 新增投诉按钮
功能: 文字输入投诉，提交到服务器

### 5. 待兑换显示 ⭐新增功能
位置: 个人资料页面资产卡片
功能: 显示待打款金额（Transaction表status='pending'的总金额）

### 6. 积分兑换 ⭐新增功能
位置: 积分页面
功能: 兑换按钮，输入积分数量，默认全部

## 技术实现要点
- 所有修改需要后端API对接
- 密码修改需要安全验证
- 小程序UI不显示人民币符号
- 邀请码绑定需要验证逻辑

## 7. 上传功能修改 ⭐部分修改
位置: 上传页面
功能: 设备改名为账号、自动对比账号昵称、新增账号按钮、图片可选

## 8. 审核记录修改 ⭐修改现有功能
位置: 首页审核记录
功能: 显示审核失败原因和AI审核结果
失败原因: 链接不对、昵称不对、标题不存在/评论不存在（根据类型）

## 9. AI审核功能 ⭐修改现有功能
功能: 显示所有AI审核结果（初始审核+持续检查）
审核逻辑: 作者昵称数组化、比对全部设备账号

## 10. 登录注册修改 ⭐修改现有功能
位置: 登录注册页面
功能: 一键登录失败跳转注册、注册支持邀请码输入

## 11. 网页端积分管理页面 ⭐新增功能
位置: admin/finance页面
权限: 仅老板主管
功能: 修改任务积分和分销积分，积分兑换改为100:1

## 12. 兼职用户管理修改 ⭐部分修改
位置: 网页端用户管理页面
功能: 提现按钮（将pending交易改为completed）、邀请码管理
权限: 仅主管老板可提现

## 13. 投诉管理页面 ⭐新增功能
位置: 网页端
权限: 仅老板主管
功能: 查看用户投诉

## 服务器端接口清单

### 用户信息管理
- PUT /api/user/profile - 更新用户信息
- GET /api/user/me - 获取用户信息（扩展积分号显示）
- POST /api/auth/logout - 用户登出

### 邀请码系统
- POST /api/user/bind-invitation - 绑定邀请码
- GET /api/user/invitation-code - 获取邀请码
- GET /api/user/referral-tree - 获取上下级关系

### 分销积分系统
- GET /api/user/distribution-points - 分销积分信息
- GET /api/user/referral-stats - 推荐统计

### 投诉系统
- POST /api/complaints - 提交投诉
- GET /api/complaints - 获取投诉列表

### 积分兑换系统
- POST /api/points/redeem - 积分兑换（100:1）
- GET /api/user/pending-amount - 待打款金额

### 设备/账号管理
- POST /api/devices - 新增设备
- PUT /api/devices/:id - 修改设备
- DELETE /api/devices/:id - 删除设备
- POST /api/devices/verify - AI审核设备

### 审核系统增强
- PUT /api/reviews/failure-reasons - 更新失败原因
- GET /api/reviews/ai-results - AI审核结果
- POST /api/client/tasks/batch-submit - 批量提交（图片可选）

### 登录注册增强
- POST /api/auth/user-register - 带邀请码注册
- GET /api/auth/check-phone - 检查手机号

### 网页端管理功能
- GET /api/admin/task-points - 任务积分管理
- PUT /api/admin/task-points - 修改积分
- POST /api/admin/withdraw - 执行提现
- PUT /api/admin/user-invitation - 修改邀请码

### 数据模型扩展
- User模型: 添加邀请码、投诉记录等字段
- Device模型: 添加审核状态、AI审核结果
- Review模型: 添加失败原因、AI审核结果
- 新建Complaint模型: 存储投诉信息

## 开发状态标记
- ⭐新增功能: 完全新的功能
- ⭐修改现有功能: 对现有功能的增强
- ⭐部分修改: 既有新增又有修改