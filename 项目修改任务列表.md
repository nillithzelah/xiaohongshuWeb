# 项目修改任务列表

## 概述
基于现有项目代码分析，本任务列表将文档中的功能需求转换为具体的实施步骤。

## 任务列表

### 1. 个人信息修改功能 ⭐新增
**位置**: `miniprogram/pages/profile/`
**后端**: `server/routes/user.js`, `server/models/User.js`

**任务步骤**:
1. 修改 `profile.wxml` 添加修改按钮和输入表单
2. 修改 `profile.js` 添加修改用户信息的方法
3. 在 `server/routes/user.js` 添加 `PUT /api/user/profile` 接口
4. 修改 `server/routes/user.js` 的 `GET /api/user/me` 接口，添加积分号Z/W脱敏显示
5. 添加登出功能 `POST /api/auth/logout`

### 2. 邀请码系统 ⭐新增
**位置**: `miniprogram/pages/profile/`, `miniprogram/pages/login/`
**后端**: `server/routes/user.js`, `server/models/User.js`

**任务步骤**:
1. 修改 `profile.wxml` 显示用户邀请码
2. 修改 `profile.js` 添加邀请码绑定功能
3. 修改 `login.wxml` 注册页面添加邀请码输入框
4. 修改 `login.js` 注册逻辑支持邀请码
5. 在 `server/routes/user.js` 添加邀请码相关接口：
   - `POST /api/user/bind-invitation`
   - `GET /api/user/invitation-code`
   - `GET /api/user/referral-tree`
6. 修改 `server/models/User.js` 添加邀请码字段

### 3. 设备管理改名和功能扩展 ⭐部分修改
**位置**: `miniprogram/pages/device-list/`
**后端**: `server/routes/devices.js`, `server/models/Device.js`

**任务步骤**:
1. 修改 `device-list.wxml` 和 `device-list.js` 中的"设备"为"账号"
2. 添加新增账号功能UI和逻辑
3. 添加修改账号昵称功能UI和逻辑
4. 添加删除账号功能UI和逻辑
5. 添加AI审核机制，调用 `POST /api/devices/verify`
6. 在 `server/routes/devices.js` 添加：
   - `POST /api/devices` 新增设备
   - `DELETE /api/devices/:id` 删除设备
   - `POST /api/devices/verify` AI审核接口
7. 修改 `server/models/Device.js` 添加审核状态字段

### 4. 分销系统展示 ⭐新增
**位置**: 新建 `miniprogram/pages/distribution/`
**后端**: `server/routes/user.js`

**任务步骤**:
1. 创建新的分销页面文件
2. 在 `miniprogram/app.json` 添加页面配置
3. 在 `profile.wxml` 添加分销按钮
4. 实现上下级关系显示逻辑
5. 在 `server/routes/user.js` 添加分销积分接口：
   - `GET /api/user/distribution-points`
   - `GET /api/user/referral-stats`

### 5. 投诉功能 ⭐新增
**位置**: 新建 `miniprogram/pages/complaint/`
**后端**: 新建 `server/routes/complaints.js`, 新建 `server/models/Complaint.js`

**任务步骤**:
1. 创建投诉页面文件
2. 在 `miniprogram/app.json` 添加页面配置
3. 在 `profile.wxml` 添加投诉按钮
4. 实现投诉提交逻辑
5. 创建 `server/models/Complaint.js` 模型
6. 创建 `server/routes/complaints.js` 路由：
   - `POST /api/complaints` 提交投诉
   - `GET /api/complaints` 获取投诉列表

### 6. 待兑换显示 ⭐新增
**位置**: `miniprogram/pages/profile/`
**后端**: `server/routes/user.js`

**任务步骤**:
1. 修改 `profile.wxml` 资产卡片添加待兑换金额显示
2. 修改 `profile.js` 获取待打款金额
3. 在 `server/routes/user.js` 添加 `GET /api/user/pending-amount` 接口
4. 修改UI，去掉人民币符号

### 7. 积分兑换 ⭐新增
**位置**: 新建 `miniprogram/pages/points-exchange/`
**后端**: `server/routes/user-management.js`

**任务步骤**:
1. 创建积分兑换页面
2. 在 `miniprogram/app.json` 添加页面配置
3. 在 `profile.wxml` 添加兑换入口
4. 实现积分兑换逻辑（100积分=1元）
5. 修改 `server/routes/user-management.js` 的积分兑换接口，调整兑换比例

### 8. 上传功能修改 ⭐部分修改
**位置**: `miniprogram/pages/upload/`
**后端**: `server/routes/client.js`

**任务步骤**:
1. 修改 `upload.wxml` 和 `upload.js` 中的"设备"为"账号"
2. 修改AI审核逻辑为自动对比全部账号昵称
3. 添加新增账号按钮
4. 确认图片可选逻辑（已实现）
5. 调整UI，将上传图片移至下方
6. 修改 `server/routes/client.js` 的 `POST /api/client/tasks/batch-submit` 移除图片强制验证

### 9. 审核记录修改 ⭐修改现有功能
**位置**: `miniprogram/pages/index/`
**后端**: `server/routes/client.js`, `server/models/ImageReview.js`

**任务步骤**:
1. 修改 `index.wxml` 审核记录卡片，添加失败原因显示
2. 修改 `index.js` 处理审核失败原因数据
3. 添加AI审核结果显示
4. 修改 `server/models/ImageReview.js` 添加失败原因字段
5. 修改 `server/routes/client.js` 的审核逻辑，根据任务类型显示不同失败原因

### 10. AI审核功能增强 ⭐修改现有功能
**位置**: `server/routes/client.js`, `server/services/xiaohongshuService.js`
**后端**: `server/models/ImageReview.js`

**任务步骤**:
1. 修改AI审核逻辑，作者昵称改为数组
2. 修改比对逻辑，比对用户全部设备账号
3. 增强失败原因显示
4. 修改 `server/models/ImageReview.js` 添加AI审核结果字段
5. 修改 `server/services/xiaohongshuService.js` 实现数组比对

### 11. 登录注册修改 ⭐修改现有功能
**位置**: `miniprogram/pages/login/`
**后端**: `server/routes/auth.js`

**任务步骤**:
1. 修改 `login.js` 一键登录失败逻辑，跳转注册页面
2. 修改 `login.wxml` 注册页面添加邀请码输入
3. 修改 `login.js` 注册失败提示逻辑
4. 修改 `server/routes/auth.js` 的 `POST /api/auth/user-register` 支持邀请码
5. 添加 `GET /api/auth/check-phone` 接口

### 12. 网页端积分管理页面 ⭐新增
**位置**: `admin/src/pages/` 或 `finance/src/pages/`
**后端**: 新建管理页面路由

**任务步骤**:
1. 在admin或finance项目中创建积分管理页面
2. 添加权限控制（仅老板主管）
3. 实现任务积分和分销积分修改功能
4. 修改积分兑换比例为100:1
5. 添加后端接口：
   - `GET /api/admin/task-points`
   - `PUT /api/admin/task-points`

### 13. 兼职用户管理修改 ⭐部分修改
**位置**: 网页端用户管理页面
**后端**: `server/routes/user-management.js`

**任务步骤**:
1. 在用户管理页面添加提现按钮
2. 添加权限控制（仅主管老板可见）
3. 实现提现功能（更新Transaction状态）
4. 添加邀请码显示和修改功能
5. 在 `server/routes/user-management.js` 添加 `POST /api/admin/withdraw` 接口
6. 添加 `PUT /api/admin/user-invitation` 接口

### 14. 投诉管理页面 ⭐新增
**位置**: 网页端
**后端**: `server/routes/complaints.js`

**任务步骤**:
1. 创建投诉管理页面
2. 添加权限控制（仅老板主管）
3. 实现投诉列表显示
4. 使用现有的 `GET /api/complaints` 接口

### 15. 数据模型扩展 ⭐扩展
**位置**: `server/models/`

**任务步骤**:
1. 修改 `User.js` 添加邀请码、投诉记录等字段
2. 修改 `Device.js` 添加审核状态、AI审核结果字段
3. 修改 `ImageReview.js` 添加失败原因、AI审核结果字段
4. 创建 `Complaint.js` 模型

### 16. UI样式调整 ⭐修改
**位置**: 各页面 `.wxss` 文件

**任务步骤**:
1. 检查所有金额显示，去掉人民币符号
2. 调整资产卡片布局，添加待兑换显示
3. 优化审核记录显示，添加失败原因和AI结果
4. 调整上传页面布局

## 实施优先级建议

**高优先级**（核心功能）:
1. 个人信息修改功能
2. 积分兑换功能
3. 待兑换显示
4. 审核记录修改

**中优先级**（重要功能）:
5. 设备管理扩展
6. 投诉功能
7. 上传功能修改
8. AI审核增强

**低优先级**（辅助功能）:
9. 分销系统展示
10. 邀请码系统完善
11. 网页端管理功能
12. UI样式优化

## 测试要点

1. 每个功能修改后进行单元测试
2. 端到端测试所有用户流程
3. 权限控制测试
4. 数据安全验证
5. 移动端兼容性测试