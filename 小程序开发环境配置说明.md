# 小程序开发环境配置说明

## 📋 配置概述

为了方便在开发环境和生产环境之间切换，我们创建了统一的API配置管理系统。

## 📁 文件结构

```
miniprogram/
├── config.js          # API配置管理文件
├── pages/
│   └── upload/
│       └── upload.js  # 已更新使用配置
```

## ⚙️ 配置说明

### config.js 配置内容

```javascript
const config = {
  // 开发环境配置
  development: {
    baseUrl: 'http://localhost:5000',
    env: 'development'
  },

  // 生产环境配置
  production: {
    baseUrl: 'https://www.wubug.cc',
    env: 'production'
  }
};

// 当前环境设置
const CURRENT_ENV = 'development'; // 🔧 修改这里切换环境
```

### API路径配置

```javascript
API: {
  // 用户相关
  DEVICE_MY_LIST: `${baseUrl}/xiaohongshu/api/client/device/my-list`,

  // 上传相关
  UPLOAD_IMAGE: `${baseUrl}/xiaohongshu/api/upload/image`,
  UPLOAD_IMAGES: `${baseUrl}/xiaohongshu/api/upload/images`,

  // 任务相关
  TASK_SUBMIT: `${baseUrl}/xiaohongshu/api/client/task/submit`,
  TASKS_BATCH_SUBMIT: `${baseUrl}/xiaohongshu/api/client/tasks/batch-submit`
}
```

## 🚀 使用方法

### 1. 开发环境测试

```javascript
// config.js 中设置
const CURRENT_ENV = 'development'; // 使用本地服务器
```

**API地址**: `http://localhost:5000/xiaohongshu/api/...`

### 2. 生产环境部署

```javascript
// config.js 中设置
const CURRENT_ENV = 'production'; // 使用生产服务器
```

**API地址**: `https://www.wubug.cc/xiaohongshu/api/...`

### 3. 切换环境

只需要修改 `config.js` 中的 `CURRENT_ENV` 变量：

```javascript
// 开发环境
const CURRENT_ENV = 'development';

// 生产环境
const CURRENT_ENV = 'production';
```

## 🔧 故障排除

### 问题：小程序无法连接服务器

**检查步骤**:
1. 确认服务器是否启动: `cd server && npm start`
2. 确认环境配置: 检查 `CURRENT_ENV` 设置
3. 确认端口配置: 本地开发默认 `5000` 端口

### 问题：API请求失败

**检查步骤**:
1. 查看小程序控制台错误信息
2. 确认服务器日志输出
3. 检查网络连接和防火墙设置

## 📝 开发提示

- **开发时**: 设置为 `development`，使用本地服务器
- **测试时**: 设置为 `development`，确保本地服务器运行
- **发布时**: 设置为 `production`，使用生产域名

## 🎯 优势

1. **统一管理**: 所有API地址集中管理
2. **环境隔离**: 开发和生产环境完全隔离
3. **快速切换**: 一行代码切换整个环境
4. **易于维护**: 新增API只需在配置中添加

现在你可以轻松在开发和生产环境之间切换了！🎉